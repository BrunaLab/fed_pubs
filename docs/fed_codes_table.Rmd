---
title: "Articles Published by US Federal Personnel"
subtitle: "January 2019 - May 2025)"
author: "Emilio M. Bruna"
date: "`r format(Sys.time(), '%d %B %Y')`"
# output: html_document
# output: pdf_document
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: true
# mainfont: "Palatino"
mainfont: "Times New Roman"


geometry: margin=1in
fontsize: 11pt
linkcolor: darkmidnightblue
urlcolor: darkmidnightblue
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \usepackage{parskip}
  - \usepackage{geometry}
  - \usepackage{caption}
  - \usepackage{xcolor}
  - \definecolor{darkmidnightblue}{rgb}{0.0, 0.2, 0.4}
  - \AtBeginDocument{\let\maketitle\relax}
  - \usepackage[none]{hyphenat}
  - \usepackage{setspace}
  - \usepackage[document]{ragged2e}
  - \usepackage{graphicx}
  - \usepackage{sectsty}\allsectionsfont{\raggedright}
  - \usepackage{sectsty}\sectionfont{\centering\color{darkmidnightblue}}
  - \usepackage{sectsty}\subsectionfont{\centering\color{darkmidnightblue}}
  - \usepackage{titlesec}
  - \usepackage[export]{adjustbox}
  - \titlespacing{\section}{0pt}{24pt plus 2pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsection}{0pt}{12pt plus 2pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \titlespacing{\subsubsection}{0pt}{12pt plus 2pt minus 1pt}{0pt plus 1pt minus 1pt}
  - \usepackage{floatrow}
  - \DeclareFloatSeparators{mysep}{\hskip-94em}
  # - \floatsetup[figure]{capposition=beside,capbesidesep=mysep,capbesideposition={right, center}}
  - \usepackage{float}
  - \usepackage{wrapfig} 
  - \usepackage{pdflscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
  # - \usepackage[font=small,labelfont=bf,labelsep=space]{caption}
  # - \captionsetup{figurename=Fig.,tablename=Table}
  # - \usepackage[labelfont=bf]{caption}
  # - \captionsetup{font=footnotesize, textfont=footnotesize}
  - \fancyfoot{} # cues the use of fancy footer
  - \fancyhead[L]{Emilio M Bruna} # month & year on header left 
  - \fancyhead[R]{`r format(Sys.time(), '%d %B %Y')`} # name and page on header right
#Required for specifying captions t
  # - \usepackage{indentfirst}
  # - \setlength\parindent{22pt} # uncomment if you want indented paragraphs


# https://pubs.usgs.gov/search?q=&startYear=2019&__ncforminfo=Rf6y9tBB_4xn4sDOJ7tdSPmxI5Eu33dcCKy8YpAAAQRE-JJvXyAJAosPJMziEEMnxQE_iCi7dgGWVwrbQe9Gpb9a-7115VxO

---


## Supplementary Materials - Scopus Affiliation Codes for Federal Agencies



```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
# library(gghighlight)
library(kableExtra)
# library(ggrepel)
# library(knitr)
# library(progress)
# library(fs)
library(textclean)
library(data.table)
library(here)

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

options(scipen = 999)
knitr::asis_output("\0430")

comma <- function(x) format(x, digits = 2, big.mark = ",")

knitr::opts_chunk$set(fig.pos = "H")
```

<!-- need to confirm 112988162 us usaid -->

<!-- 60004062 -->
<!-- epa -->
<!-- arkansas department of energy and environment -->

<!-- 9 -->
<!-- 60077294 -->
<!-- NA -->
<!-- association of the us army -->
<!-- 129027339 -->
<!-- NA -->
<!-- inc under contract to the us geological -->

<!-- 105428030 -->
<!-- NA -->
<!-- association of the us army -->

<!-- 118735849 -->
<!-- NA -->
<!-- asrc federal inuteq (contractor to the usgs) -->

<!-- 125564413 -->
<!-- NA -->
<!-- contracted to the usgs -->
<!-- contacted -->
<!-- contractor -->
<!-- under contract -->
<!-- biscayne national parknational park serviceus department of the interior -->
<!-- h -->


```{r data, cache=FALSE }

pull <-
  read_rds('./data_clean/affils_df_clean.rds') %>% 
  filter(federal==TRUE) %>% 
  select(affil_id, affiliation,agency,agency_primary) %>% 
  distinct() %>% 
  mutate(affil_id = as.character(affil_id)) 


  pull$affiliation<-replace_non_ascii(pull$affiliation)
  
  # unique(pull$agency_primary)
  
pull<-pull %>%
select(agency_primary, affil_id, affiliation) %>%
  distinct(affil_id, .keep_all = TRUE) %>%
  mutate(agency_primary = case_when(
    str_detect(affiliation, " va ")~"va",
    .default = as.character(agency_primary))) %>% 
  mutate(agency_primary = case_when(
    agency_primary == "usda" ~ "Department of Agriculture",
    agency_primary == "dod" ~ "Department of Defense",
    agency_primary == "interior" ~ "Department of the Interior",
    agency_primary == "hhs" ~ "Department of Health and Human Services",
    agency_primary == "commerce" ~ "Department of Commerce",
    agency_primary == "other" ~ "Other Agencies, Commissions, or Institutions",
    agency_primary == "nsf" ~ "National Science Foundation",
    agency_primary == "state" ~ "Department of State",
    agency_primary == "doe" ~ "Department of Energy",
    agency_primary == "va" ~ "Department of Veterans Affairs",
    agency_primary == "epa" ~ "Environmental Protection Agency",
    agency_primary == "smithsonian" ~ "Smithsonian Institution",
    agency_primary == "nasa" ~ "National Aeronautics and Space Administration",
   agency_primary ==  "hud"~ "Department of Housing and Urban Development",
   agency_primary ==  "education"~ "Department of Education",
    agency_primary == "treasury"~ "Treasury Department",
   agency_primary ==  "dot"~ "Department of Transportation",
  agency_primary == "federal reserve system"~ "Federal Reserve System",
  agency_primary == "labor"~ "Labor Department",
  agency_primary == "doj"~ "Department of Justice",
 agency_primary ==  "dhs"~ "Department of Homeland Security",
    .default = as.character(agency_primary)
  )) %>%
  distinct()

pull<-pull %>%
  arrange(agency_primary, affiliation, affil_id) %>%
  group_by(affiliation) %>%
  mutate(affil_id=paste(affil_id,collapse=", ")) %>%
  distinct(affiliation, .keep_all = TRUE) %>%
  ungroup() %>%
  mutate(row = row_number()) %>% 
  arrange(agency_primary,affiliation)

# group_by(agency_primary) %>%
# mutate(ids=paste(affil_id,collapse=", ")) %>%
# mutate(affils=paste(affiliation,collapse=", ")) %>%
# fed_affils_search %>%
# write_csv(pull,"./data_intermediate/affils_for_or.csv")

# # 
# refined<-read_csv("./data_intermediate/affils-for-or-csv_OPEN_REFINED3.csv") %>%
#   mutate(cat="refined") %>% 
#   select(-affiliation)
# 
# refine_both<-left_join(pull,refined,by=c("agency_primary","affil_id","row")) %>%
#   mutate(match=(affiliation==affiliation_mod)) %>%
#   filter(match==FALSE)
#   write_csv(refine_both,"./data_intermediate/refined_for_correcting.csv")
# 
#   
  

first<-pull %>% group_by(agency_primary) %>% slice_head(n=1) %>% select(agency_primary,first=row)
last<-pull %>% group_by(agency_primary) %>% slice_tail(n=1) %>% select(agency_primary,last=row)
first_last<-left_join(first,last) %>% 
  arrange(agency_primary)
rm(first,last)

pull %>%
  select(affil_id,affiliation) %>% 
  rename(Affiliation=affiliation,
         `Scopus ID`=affil_id) %>% 
  # slice(1:750) %>% 
  kable(
    format = "latex",
    longtable = T,
    booktabs = T,
    linesep = "",
    caption = "Scopus Affiliation ID codes used in the search of research productivity by federal agencies and departments and the affiliations associated with these codes.",
    align = "rl",
  ) %>%
  # kable(digits = 2,
  #   format = "latex",
  #   align = "lll",
  #   escape = FALSE,
  #   row.names = FALSE,
  #   booktabs = T,
  #   linesep = ""
  # ) %>%
  kable_styling(
    # longtable = T,
    bootstrap_options = c("hover"),
    full_width = T,
    latex_options = c("hold_position", "repeat_header"),
    repeat_header_continued = "\\textit{(Continued on next page...)}",
    position = "center",
    font_size = 8
  ) %>%
  row_spec(0, bold = T) %>%
  column_spec(1, width = "20em") %>%
  column_spec(2, width = "40em") %>%
  # column_spec(1, width = "2em") %>% 
  pack_rows("DEPARTMENT OF AGRICULTURE", as.numeric(first_last[1,2]), as.numeric(first_last[1,3]), indent = TRUE) %>% 
pack_rows("DEPARTMENT OF COMMERCE", as.numeric(first_last[2,2]), as.numeric(first_last[2,3]), indent = TRUE) %>% 
pack_rows("DEPARTMENT OF DEFENSE", as.numeric(first_last[3,2]), as.numeric(first_last[3,3]), indent = TRUE) %>% 
pack_rows("DEPARTMENT OF EDUCATION", as.numeric(first_last[4,2]), as.numeric(first_last[4,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF ENERGY", as.numeric(first_last[5,2]), as.numeric(first_last[5,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF HEALTH AND HUMAN SERVICES", as.numeric(first_last[6,2]), as.numeric(first_last[6,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF HOMELAND SECURITY", as.numeric(first_last[7,2]), as.numeric(first_last[7,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF HOUSING AND URBAN DEVELOPMENT", as.numeric(first_last[8,2]), as.numeric(first_last[8,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF JUSTICE", as.numeric(first_last[9,2]), as.numeric(first_last[9,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF STATE", as.numeric(first_last[10,2]), as.numeric(first_last[10,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF TRANSPORTATION", as.numeric(first_last[11,2]), as.numeric(first_last[11,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF VETERANS AFFAIRS", as.numeric(first_last[12,2]), as.numeric(first_last[12,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF THE INTERIOR", as.numeric(first_last[13,2]), as.numeric(first_last[13,3]), indent = TRUE) %>% 
        pack_rows("ENVIRONMENTAL PROTECTION AGENCY", as.numeric(first_last[14,2]), as.numeric(first_last[14,3]), indent = TRUE) %>% 
    pack_rows("FEDERAL RESERVE SYSTEM", as.numeric(first_last[15,2]), as.numeric(first_last[15,3]), indent = TRUE) %>% 
    pack_rows("DEPARTMENT OF LABOR", as.numeric(first_last[16,2]), as.numeric(first_last[16,3]), indent = TRUE) %>% 
    pack_rows("NATIONAL AERONAUTICS AND SPACE ADMINISTRATION", as.numeric(first_last[17,2]), as.numeric(first_last[17,3]), indent = TRUE) %>% 
    pack_rows("NATIONAL SCIENCE FOUNDATION", as.numeric(first_last[18,2]), as.numeric(first_last[18,3]), indent = TRUE) %>% 
    pack_rows("OTHER AGENCIES, COMMISSIONS, OR INSTITUTIONS", as.numeric(first_last[19,2]), as.numeric(first_last[19,3]), indent = TRUE) %>% 
    pack_rows("SMITHSONIAN INSTITUTION", as.numeric(first_last[20,2]), as.numeric(first_last[20,3]), indent = TRUE) %>% 
  pack_rows("DEPARTMENT OF THE TREASURY", as.numeric(first_last[21,2]), as.numeric(first_last[21,3]), indent = TRUE)  

```



